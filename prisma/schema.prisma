generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                        BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  name                      String    @db.VarChar(255)
  login                     String    @unique(map: "users_login_unique") @db.VarChar(255)
  email                     String    @unique(map: "users_email_unique") @db.VarChar(255)
  phone                     String    @unique(map: "users_phone_unique") @db.VarChar(255)
  birthday                  String?   @db.VarChar(255)
  email_verified_at         DateTime? @db.Timestamp(0)
  password                  String    @db.VarChar(255)
  two_factor_secret         String?   @db.Text
  two_factor_recovery_codes String?   @db.Text
  two_factor_confirmed_at   DateTime? @db.Timestamp(0)
  remember_token            String?   @db.VarChar(100)
  current_team_id           BigInt?   @db.UnsignedBigInt
  profile_photo_path        String?   @db.VarChar(2048)
  profile                   String    @default("user")
  bep20_address             String?   @db.VarChar(255)
  bep20_public_key          String?   @db.VarChar(255)
  bep20_private_key         String?   @db.VarChar(255)
  last_login                DateTime? @db.DateTime(0)
  last_login_ip             String?   @db.VarChar(45)
  country_code              String?   @db.VarChar(255)
  country_name              String?   @db.VarChar(255)

  sponsor    User?   @relation("sponsor", fields: [sponsor_id], references: [id])
  sponsor_id BigInt? @db.UnsignedBigInt

  binary_parent_id                          BigInt?         @db.UnsignedBigInt
  position                                  users_position?
  is_active                                 Boolean         @default(false)
  created_at                                DateTime?       @db.Timestamp(0)
  updated_at                                DateTime?       @db.Timestamp(0)
  users_users_binary_parent_idTousers       User?           @relation("users_binary_parent_idTousers", fields: [binary_parent_id], references: [id], onUpdate: Restrict, map: "users_binary_parent_id_foreign")
  other_users_users_binary_parent_idTousers User[]          @relation("users_binary_parent_idTousers")
  users_users_sponsor_idTousers             User?           @relation("users_sponsor_idTousers", fields: [sponsor_id], references: [id], onUpdate: Restrict, map: "users_sponsor_id_foreign")
  other_users_users_sponsor_idTousers       User[]          @relation("users_sponsor_idTousers")

  User           User[]           @relation("sponsor")
  StrategyBinary StrategyBinary[] @relation("user")
  UserSession    UserSession[]    @relation("user")
  Order          Order[]
  Order          Order[]          @relation("user")

  @@index([binary_parent_id], map: "users_binary_parent_id_foreign")
  @@index([sponsor_id], map: "users_sponsor_id_foreign")
  @@map("users")
}

model PasswordResetToken {
  email      String    @id @db.VarChar(255)
  token      String    @db.VarChar(255)
  created_at DateTime? @db.Timestamp(0)

  @@map("password_reset_tokens")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model PasswordReset {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  email      String    @db.VarChar(255)
  token      String    @db.VarChar(255)
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)

  @@index([email], map: "password_resets_email_index")
  @@map("password_resets")
}

model PersonalAccessToken {
  id             BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  tokenable_type String    @db.VarChar(255)
  tokenable_id   BigInt    @db.UnsignedBigInt
  name           String    @db.VarChar(255)
  token          String    @unique(map: "personal_access_tokens_token_unique") @db.VarChar(64)
  abilities      String?   @db.Text
  last_used_at   DateTime? @db.Timestamp(0)
  expires_at     DateTime? @db.Timestamp(0)
  created_at     DateTime? @db.Timestamp(0)
  updated_at     DateTime? @db.Timestamp(0)

  @@index([tokenable_type, tokenable_id], map: "personal_access_tokens_tokenable_type_tokenable_id_index")
  @@map("personal_access_tokens")
}

model Product {
  id                    BigInt              @id @default(autoincrement()) @db.UnsignedBigInt
  name                  String              @db.VarChar(100)
  description           String?             @db.Text
  price                 Decimal             @db.Decimal(10, 2)
  direct_bonus          Boolean?
  direct_bonus_yield    Decimal?            @db.Decimal(5, 4)
  yield_type            products_yield_type @default(diary)
  yield                 Decimal             @db.Decimal(10, 7)
  unilevel_bonus        Boolean?            @default(false)
  unilevel_bonus_yields String?             @db.LongText
  created_at            DateTime?           @db.Timestamp(0)
  updated_at            DateTime?           @db.Timestamp(0)

  @@map("products")
}

model UserSession {
  id           BigInt  @id @default(autoincrement()) @db.UnsignedBigInt
  access_token String  @db.LongText
  ip_address   String? @db.VarChar(45)

  user    User?   @relation("user", fields: [user_id], references: [id])
  user_id BigInt? @db.UnsignedBigInt

  status user_session @default(active)

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model Session {
  id      String  @id @db.VarChar(255)
  user_id BigInt? @db.UnsignedBigInt

  ip_address    String? @db.VarChar(45)
  user_agent    String? @db.Text
  payload       String  @db.LongText
  last_activity Int

  @@index([last_activity], map: "sessions_last_activity_index")
  @@index([user_id], map: "sessions_user_id_index")
  @@map("sessions")
}

model StrategyBinary {
  id      BigInt  @id @default(autoincrement()) @db.UnsignedBigInt
  user    User?   @relation("user", fields: [user_id], references: [id])
  user_id BigInt? @db.UnsignedBigInt

  ref           String @default("")
  hier          String @db.LongText()
  level         Int    @default(0)
  autoDirection String @default("L")

  parent    StrategyBinary? @relation("parent", fields: [parent_id], references: [id])
  parent_id BigInt?         @db.UnsignedBigInt

  left       StrategyBinary? @relation("left", fields: [left_id], references: [id])
  left_id    BigInt?         @db.UnsignedBigInt
  left_count BigInt          @default(0)

  right       StrategyBinary? @relation("right", fields: [right_id], references: [id])
  right_id    BigInt?         @db.UnsignedBigInt
  right_count BigInt          @default(0)

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  ParentStrategyBinary StrategyBinary[] @relation("parent")
  LeftStrategyBinary   StrategyBinary[] @relation("left")
  RightStrategyBinary  StrategyBinary[] @relation("right")

  @@map("strategy_binary")
}

model Order {
  id       BigInt  @id @default(autoincrement()) @db.UnsignedBigInt
  order_id String
  user     User?   @relation("user", fields: [user_id], references: [id])
  user_id  BigInt? @db.UnsignedBigInt

  status    Status
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  @@map("order")
}

model OrderItem {
  id       BigInt @id @default(autoincrement()) @db.UnsignedBigInt
  order    Order  @relation("order", fields: [order_id], references: [id])
  order_id BigInt @db.UnsignedBigInt

  product    Product @relation("product", fields: [product_id], references: [id])
  product_id BigInt  @db.UnsignedBigInt

  quantity Int     @default(1)
  amount   Decimal @db.Decimal(10, 2)

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  @@map("order_item")
}

enum products_yield_type {
  diary
  weekly
  monthly
  semiannual
  annual
}

enum users_profile {
  admin
  user
  admin_watch
}

enum users_position {
  left
  right
}

enum user_session {
  active
  inactive
}

enum Status {
  init
  pending
  payed
  done
  canceled
}
